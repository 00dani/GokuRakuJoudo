os: osx
language: clojure
before_install:
  - sh scripts/travis.sh
  - wget https://github.com/oracle/graal/releases/download/vm-1.0.0-rc6/graalvm-ce-1.0.0-rc6-macos-amd64.tar.gz
  - tar xf graalvm-ce-1.0.0-rc6-macos-amd64.tar.gz
  - export PATH=$PATH:$PWD/graalvm-ce-1.0.0-rc6/Contents/Home/bin/
script:
  - lein test
  - make
  - make test-binary
  - ./goku
cache:
  directories:
  - $HOME/.m2
  - $HOME/Library/Caches/Homebrew
  - /usr/local/Cellar/leiningen/
  - /usr/local/Cellar/watchexec/
after_success:
  - lein cloverage --no-html --coveralls
  - curl -X "POST" "https://coveralls.io/api/v1/jobs" \
         -H 'Content-Type: multipart/form-data; charset=utf-8;' \
         -F "json_file=@./target/coverage/coveralls.json"
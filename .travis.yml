os: osx
language: clojure
before_install:
  - sh scripts/travis.sh
  - wget https://github.com/oracle/graal/releases/download/vm-1.0.0-rc6/graalvm-ce-1.0.0-rc6-macos-amd64.tar.gz
  - tar xf graalvm-ce-1.0.0-rc6-macos-amd64.tar.gz
  - export PATH=$PATH:$PWD/graalvm-ce-1.0.0-rc6/Contents/Home/bin/
script:
  - lein test
  - lein cloverage --no-html --coveralls
  - make
  - make test-binary
  - ./goku
  - cat ./target/coverage/coveralls.json
cache:
  directories:
  - $HOME/.m2
  - $HOME/Library/Caches/Homebrew
  - /usr/local/Cellar/leiningen/
  - /usr/local/Cellar/watchexec/
after_success:
  - curl -X POST -H "Content-Type: application/json" --data @./target/coverage/coveralls.json https://coveralls.io/api/v1/jobs